<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>audio demo</title>
    <style type="text/css">
      button {
        background-color: green;
        width:50%;
        height:50px;
        font-size:30px;
      }

      textarea {
          width:500px;
          height:100px;
      }
    </style>
  </head>
  <body>
    <p><strong>Run Status</strong></p>
    <textarea id="log" disabled></textarea>
    <br>
    <p><strong>select conditions:</strong> </p>
    <div class="conditions" id="conditions">
        <label for="sampleRate">Select Sample Rate &nbsp;&nbsp;:</label>
        <select id="sampleRate">
            <option value="16000">16K Hz</option>
            <option value="48000">48K Hz</option>
            <option value="0">default</option>
        </select>
        <br>
        <br>
        <label for="peerCodec">Peer Conn Codec &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</label>
        <select id="peerCodec">
            <option value="L16/16000">L16 16K</option>
            <option value="L16/48000">L16 48K</option>
            <option value="default">default</option>
        </select>
    </div>
    <br>
    <p><strong>select speaker devices list:</strong></p>
    <div class="outputs" id="outputs">
    </div>
    <br>
    <button onclick="StartText(this)" id="startText">Start Test</button>

    <script src="audioapi.js"></script>
    <script src="common.js"></script>
    <script src="play.js"></script>
    <script>
        let pcmFileDom = document.getElementById("pcmFile");
        let startButton = document.getElementById("startText");
        let sampleRateDom = document.getElementById("sampleRate");
        let peerCodecDom = document.getElementById("peerCodec");
        let interpretationEnableDom = document.getElementById("interpretationEnable");

        let audioTest;

        let isStartTest = true;
        function StartText() {
            let sampleRate = parseInt(sampleRateDom.value);
            let peerCodec = peerCodecDom.value;

            startButton.disabled = true;
            setTimeout(() => {
                startButton.disabled = false;
            }, 2000);

            if (!isStartTest) {
                audioTest.stop();
                audioTest = null;
                isStartTest = true ;
                startButton.textContent = "Start Test";
                log("Test Stop...")
                return ;
            }

            startButton.textContent = "Stop Test";
            
            let outputDeviceId;
            let outputs = outputsDom.querySelectorAll("input");
            outputs.forEach(input => {
                if (input.checked) {
                    outputDeviceId = input.id;
                }
            })
            if (audioTest) {
                audioTest.stop();
                audioTest = null;
            }

            audioTest = new AudioTest(outputDeviceId, sampleRate, peerCodec);
            audioTest.start();
            isStartTest = false;
        }

    </script>
  </body>
</html>


